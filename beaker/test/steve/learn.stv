foreign def puts(char[]) -> int;

layout eth
{
	src : uint(48);
	dst : uint(48);
	type : uint(16);
}


decoder start eth_d(eth)
{
	extract eth.src;
  extract eth.dst;
  goto learn;
}


event learn_mac
	requires(eth.src)
{
	add
	[timeout = 1000]
	{ eth.src } ->
	{
		// puts("Using learned in learn.");
		goto switch;
	}
	into learn;


	add
	{ eth.src } ->
	{
		// puts("Using learned in switch.");
		output egress;
	}
	into switch;
}


exact_table learn(eth.src)
{
	[timeout = 1000]
  miss ->
  {
		// puts("LEARN MISS");
		raise learn_mac;
    goto switch;
  }
}


exact_table switch(eth.dst)
{
  miss ->
  {
		// puts("Flood, miss.");
    flood;
  }
}
